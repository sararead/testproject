version: 2.1

orbs:
  terraform: ovotech/terraform@dev:name

  jobs:
    - terraform/plan:
        path: "test"
        environment: "prod"
    - terraform/apply:
        path: "test"
        environment: "prod"


workflows:
  test:
    jobs:
      - terraform/plan
      - terraform/apply:
          requires:
            - terraform/plan
          filters:
            branches:
              only: master
