references:
  builderbox: &builderbox
    docker:
      - image: circleci/php:7.2.10-cli-stretch-node-browsers-legacy
    parallelism: 4
      
  make_folder: &make_folder
    run: mkdir foo
    
  do_checkout: &do_checkout
      - checkout
      - run: git status
  run_on_master_tagged: &run_on_master_tagged
    filters:
      branches:
        only: /master/
      tags:
        ignore: /^v.*/

jobs:
  build:
    <<: *builderbox
    steps:
      - run: npm install   
  test:
    <<: *builderbox
    steps:
      - checkout
      - run: git status
      - run: echo $Saras_Test
      - run: cd ios && bundle exec fastlane $FASTLANE_LANE
  secondImage:
    docker:
      - image: circleci/ruby:2.3-jessie-node-browsers
      - image: sread/get-started:part2
        auth:
          username: sread
          password: $DOCKERHUB_PASSWORD
    steps:
      - checkout
      - run: git status
  privateImage:
    docker:
      - image: sread/get-started:part2
        auth:
          username: sread
          password: $DOCKERHUB_PASSWORD
    steps:
      - checkout
      - run: git status
      
workflows:
  version: 2
  test-build-deploy:
    jobs:
      - build:
          <<: *run_on_master_tagged        
      - test:
          context: Testing
      - secondImage
      - privateImage
